---
import Layout from '../layouts/Layout.astro';

const wordLists = {
  // Vague incident starters (doublé)
  incidents: [
    "Suite aux récents événements qui ont touché notre communauté diocésaine",
    "Face aux difficultés pastorales que traverse notre diocèse en ces temps troublés",
    "Concernant les situations portées à notre attention",
    "À la lumière des témoignages qui nous sont parvenus",
    "Devant les défis pastoraux auxquels nous sommes confrontés",
    "En réponse aux préoccupations exprimées par nos fidèles",
    "Suite aux interrogations soulevées dans notre diocèse",
    "Face aux circonstances qui interpellent notre communauté",
    "Concernant les questions qui nous ont été rapportées",
    "À la suite des événements qui ont marqué notre famille diocésaine",
    "Devant les enjeux pastoraux de cette période délicate",
    "En réaction aux inquiétudes exprimées"
  ],

  // Vague acknowledgments (doublé et plus court)
  acknowledgments: [
    "nous reconnaissons que des dysfonctionnements ont pu survenir",
    "nous prenons acte des questionnements de notre communauté",
    "nous entendons les inquiétudes de nos paroissiens",
    "nous mesurons l'ampleur des interrogations suscitées",
    "nous sommes conscients des fragilités de notre institution",
    "nous accueillons les interpellations qui nous sont adressées",
    "nous admettons que des manquements ont pu se produire",
    "nous comprenons les préoccupations de nos fidèles",
    "nous entendons les questions légitimes posées",
    "nous reconnaissons les difficultés rencontrées",
    "nous sommes sensibles aux inquiétudes exprimées",
    "nous prenons la mesure des interrogations soulevées"
  ],

  apologies: [
    "manifestons notre proximité aux victimes et les encourageons à aller de l'avant par le pardon",
    "témoignons notre compassion aux personnes troublées et les invitons à tourner la page dans la réconciliation",
    "exprimons notre soutien aux âmes ébranlées et les accompagnons pour avancer par la miséricorde",
    "montrons notre solidarité aux personnes affectées et les encourageons à passer à autre chose dans le pardon",
    "manifestons notre compréhension aux victimes et les soutenons pour aller de l'avant par la réconciliation",
    "témoignons notre bienveillance aux personnes touchées et les invitons à tourner la page dans la miséricorde",
    "exprimons notre empathie aux victimes et les encourageons à regarder vers l'avenir par le pardon",
    "montrons notre attention aux personnes éprouvées et les accompagnons pour avancer dans la réconciliation",
    "manifestons notre fraternité aux victimes et les invitons à aller de l'avant par la miséricorde",
    "témoignons notre sollicitude aux âmes blessées et les encourageons à tourner la page dans le pardon",
    "exprimons notre proximité aux personnes affectées et les soutenons pour passer à autre chose par la réconciliation",
    "montrons notre compassion aux victimes et les accompagnons vers l'avenir dans la miséricorde"
  ],

  // Miséricorde (phrases plus courtes, pardon/miséricorde pour les coupables)
  misericorde: [
    "Rappelons que la miséricorde divine s'étend à tous, et doit guider notre discernement",
    "Le pardon évangélique concerne chaque membre de notre communauté, y compris les accusés",
    "La miséricorde du Christ embrasse tous les enfants de Dieu sans exception",
    "La compassion divine rayonne sur chacun. La présomption d'innocence demeure fondamentale",
    "Le pardon du Seigneur s'offre à tous, même aux plus fautifs d'entre nous",
    "Méditons sur la miséricorde infinie qui unit tous nos frères, victimes et coupables présumés, dans la charité"
  ],

  // Actions (maintenant un paragraphe séparé)
  actions: [
    "Nous agissons fermement en mettant en place un processus d'évaluation de nos pratiques",
    "Nous passons à l'action en renforçant nos dispositifs d'accompagnement spirituel",
    "Nous nous mobilisons résolument pour développer une démarche de discernement communautaire",
    "Nous prenons des mesures concrètes en instaurant des mécanismes de dialogue renforcés",
    "Nous nous engageons activement à consolider nos structures de formation pastorale",
    "Nous mettons tout en œuvre pour approfondir notre réflexion dans un esprit de synodalité"
  ],

  // "Dans la tourmente" transitions (doublé)
  tourmentes: [
    "Dans la tourmente",
    "Au cœur de la tempête",
    "En ces temps d'épreuve",
    "Malgré les turbulences",
    "Dans cette période difficile",
    "Au sein de ces bouleversements",
    "Face à l'adversité",
    "Dans ces moments troublés",
    "Malgré les difficultés",
    "En dépit des épreuves",
    "Dans ce contexte délicat",
    "Au milieu des défis"
  ],

  // Good fruits deflection (doublé)
  goodFruits: [
    "il convient de ne pas occulter les fruits de grâce de nos paroisses",
    "nous devons garder à l'esprit les témoignages de foi de notre diocèse",
    "il serait injuste d'ignorer les actions caritatives de nos communautés",
    "nous ne saurions oublier les vocations qui confirment l'Esprit Saint",
    "rappelons-nous les signes d'espérance de notre Église",
    "gardons présents les élans missionnaires qui nous dynamisent",
    "il importe de souligner les merveilles qui s'accomplissent dans nos paroisses",
    "nous devons reconnaître les conversions authentiques de notre diocèse",
    "il serait dommage d'omettre les œuvres caritatives de nos fidèles",
    "nous ne pouvons ignorer les grâces qui abondent dans nos communautés",
    "rappelons les initiatives généreuses qui fleurissent dans notre Église",
    "gardons en mémoire les projets porteurs d'espérance qui nous animent"
  ],

  // Origin deflection (doublé)
  originDeflection: [
    "sans nous leurrer sur l'origine de ces perturbations",
    "en gardant à l'esprit les sources de ces troubles",
    "sans perdre de vue les ferments de division",
    "sans ignorer les véritables causes de ces difficultés",
    "en identifiant clairement les racines de ces tensions",
    "sans oublier les influences qui alimentent ces polémiques"
  ],

  // Scapegoats (doublé)
  scapegoats: [
    "certains médias en quête de sensationnalisme",
    "des mouvements traditionalistes fermés au souffle de l'Esprit",
    "des lobbies progressistes déconnectés de la Tradition",
    "des réseaux occultes hostiles à l'Évangile",
    "des groupuscules anticléricaux",
    "des influences séculières cherchant à saper notre rayonnement",
    "des organes de presse avides de polémiques",
    "des courants intégristes figés dans leurs certitudes",
    "des factions modernistes étrangères à l'Église",
    "des cercles opposés à la mission évangélisatrice",
    "des militants nourris de préjugés anti-religieux",
    "des forces s'acharnant à ternir notre image"
  ],

  // Spiritual endings (doublé)
  spiritualEndings: [
    "afin d'ouvrir des fenêtres d'espérance sur l'éternité",
    "pour que jaillissent des sources de grâce dans nos cœurs",
    "en vue de faire germer la paix évangélique dans nos âmes",
    "dans l'espoir de voir fleurir la miséricorde divine",
    "pour que résonne la mélodie céleste dans nos prières",
    "afin que s'épanouisse la lumière du Christ",
    "pour que s'ouvrent les chemins de la réconciliation",
    "afin que rayonnent les fruits de l'Esprit Saint",
    "en vue de cultiver les vertus théologales dans nos communautés",
    "dans l'attente de voir grandir la communion fraternelle",
    "pour que s'accomplisse la volonté divine dans nos vies",
    "afin que se manifestent les signes du Royaume"
  ],

  // Bullshitty closings (doublé)
  closings: [
    "Concentrons-nous sur ce qui est beau et évangélique",
    "Tournons nos regards vers l'espérance chrétienne plutôt que vers les polémiques",
    "Privilégions nos liturgies aux controverses médiatiques",
    "Préférons l'écoute fraternelle aux clameurs stériles",
    "Choisissons le dialogue plutôt que les divisions",
    "Focalisons-nous sur notre mission d'évangélisation",
    "Orientons nos cœurs vers la beauté de la foi",
    "Dirigeons notre attention vers les merveilles de la Création plutôt que vers les divisions",
    "Favorisons la prière contemplative aux débats stériles",
    "Préférons la méditation spirituelle aux polémiques destructrices",
    "Choisissons la charité chrétienne plutôt que les affrontements",
    "Concentrons-nous sur l'essentiel de notre vocation pastorale"
  ]
};

// Générateur de noms d'évêques satiriques
const bishopNames = [
  "Mgr Claude-Henri de Miséricorde",
  "Mgr Adalbert de Contournement", 
  "Mgr Séraphin du Détournement",
  "Mgr Boniface de l'Esquive",
  "Mgr Théophile de la Langue-de-Bois",
  "Mgr Ambroise du Flou-Artistique",
  "Mgr Pacôme de l'Évitement",
  "Mgr Chrysostome de la Diversion",
  "Mgr Bénédict de l'Évasion",
  "Mgr Anselme du Détournement-d'Attention"
];
---

<Layout title="Pipotron Épiscopal">
  <div class="py-4">
    <!-- Title -->
    <h1 class="mb-6 text-4xl font-bold text-center">Pipotron Épiscopal</h1>
    
    <!-- Barre de progression satirique -->
    <div id="progressBar" class="mb-6 mx-auto max-w-4xl hidden">
      <div class="bg-gray-200 rounded-full h-2 mb-2">
        <div id="progressFill" class="bg-yellow-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
      <p id="progressText" class="text-center text-sm text-gray-600 italic"></p>
    </div>
    
    <!-- Official Document Result Area -->
    <div class="mb-6 mx-auto max-w-4xl">
      <div class="bg-gray-100 text-black rounded-lg shadow-2xl border-4 border-gray-400 relative overflow-hidden">
        <!-- Official Header -->
        <div class="bg-gray-600 text-white p-6 text-center border-b-4 border-gray-400">
          <div class="flex items-center justify-center space-x-4">
            <div>
              <h2 class="text-xl font-bold">COMMUNIQUÉ DE PRESSE</h2>
              <p class="text-sm opacity-90">Diocèse de Saint-Barbant</p>
            </div>
          </div>
        </div>
        
        <!-- Document Content -->
        <div class="p-8">
          <div id="result" class="min-h-32 flex items-center justify-center">
            <p class="text-gray-500 text-center italic">
              Cliquez sur "Générer un nouveau" pour créer un communiqué de miséricorde
            </p>
          </div>
        </div>
        
        <!-- Compteur de bullshit -->
        <div id="bullshitMeter" class="hidden bg-yellow-100 border-t-2 border-yellow-300 p-4">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium">Niveau de langue de bois :</span>
            <div id="bullshitStars" class="text-yellow-500"></div>
          </div>
        </div>
        
        <!-- Decorative corners -->
        <div class="absolute top-0 left-0 w-8 h-8 border-l-4 border-t-4 border-gray-400"></div>
        <div class="absolute top-0 right-0 w-8 h-8 border-r-4 border-t-4 border-gray-400"></div>
        <div class="absolute bottom-0 left-0 w-8 h-8 border-l-4 border-b-4 border-gray-400"></div>
        <div class="absolute bottom-0 right-0 w-8 h-8 border-r-4 border-b-4 border-gray-400"></div>
      </div>
    </div>

    <!-- Generate Button -->
    <div class="text-center mb-6">
      <button 
        id="generateBtn" 
        class="btn btn-lg bg-yellow-600 text-black hover:bg-yellow-700 font-semibold mr-4"
      >
        🙏 Générer un nouveau communiqué de miséricorde
      </button>
      <button 
        id="translateBtn" 
        class="btn btn-lg bg-red-600 text-white hover:bg-red-700 font-semibold hidden"
      >
        🔍 Traduire en français normal
      </button>
    </div>

    <!-- Instructions -->
    <div class="mb-6 p-4 bg-white/5 rounded-lg border border-white/10">
      <p class="text-center text-white/90">
        Ou composez manuellement votre communiqué en sélectionnant dans les listes ci-dessous (dans l'ordre d'apparition)
      </p>
    </div>

    <!-- Word Lists Grid - Dans l'ordre d'apparition -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
      <!-- Incident -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">📰 Incident (flou)</label>
        <select 
          id="incidents" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.incidents.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Reconnaissance -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">😔 Reconnaissance (partielle)</label>
        <select 
          id="acknowledgments" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.acknowledgments.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Excuses -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">💔 Excuses (rapides)</label>
        <select 
          id="apologies" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.apologies.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Miséricorde -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">🙏 Miséricorde (sélective)</label>
        <select 
          id="misericorde" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.misericorde.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Actions -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">⚡ Actions (vagues)</label>
        <select 
          id="actions" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.actions.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Bons fruits -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">🍇 Bons fruits (obligatoires)</label>
        <select 
          id="goodFruits" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.goodFruits.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Origine -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">🔍 Origine (détournée)</label>
        <select 
          id="originDeflection" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.originDeflection.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Boucs émissaires -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">🎯 Boucs émissaires (pratiques)</label>
        <select 
          id="scapegoats" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.scapegoats.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Fins spirituelles -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">✨ Fins spirituelles (creuses)</label>
        <select 
          id="spiritualEndings" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.spiritualEndings.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>

      <!-- Conclusion -->
      <div class="bg-white/5 rounded-lg p-3 border border-white/10">
        <label class="block text-white font-medium mb-2 text-sm">🌸 Conclusion (détournement)</label>
        <select 
          id="closings" 
          class="w-full p-2 bg-white/10 border border-white/20 rounded text-white text-xs" 
          size="4"
        >
          <option value="">-- Choisir --</option>
          {wordLists.closings.map(word => <option value={word}>{word}</option>)}
        </select>
      </div>
    </div>

    <!-- Reset Button -->
    <div class="text-center mt-6">
      <button 
        id="resetBtn" 
        class="btn bg-white/10 text-white hover:bg-white/20"
      >
        🔄 Réinitialiser
      </button>
    </div>
  </div>

  <script>
    const wordLists = {
      incidents: [
        "Suite aux récents événements qui ont touché notre communauté diocésaine",
        "Face aux difficultés pastorales que traverse notre diocèse en ces temps troublés",
        "Concernant les situations portées à notre attention",
        "À la lumière des témoignages qui nous sont parvenus",
        "Devant les défis pastoraux auxquels nous sommes confrontés",
        "En réponse aux préoccupations exprimées par nos fidèles",
        "Suite aux interrogations soulevées dans notre diocèse",
        "Face aux circonstances qui interpellent notre communauté",
        "Concernant les questions qui nous ont été rapportées",
        "À la suite des événements qui ont marqué notre famille diocésaine",
        "Devant les enjeux pastoraux de cette période délicate",
        "En réaction aux inquiétudes exprimées"
      ],
      acknowledgments: [
        "nous reconnaissons que des dysfonctionnements ont pu survenir",
        "nous prenons acte des questionnements de notre communauté",
        "nous entendons les inquiétudes de nos paroissiens",
        "nous mesurons l'ampleur des interrogations suscitées",
        "nous sommes conscients des fragilités de notre institution",
        "nous accueillons les interpellations qui nous sont adressées",
        "nous admettons que des manquements ont pu se produire",
        "nous comprenons les préoccupations de nos fidèles",
        "nous entendons les questions légitimes posées",
        "nous reconnaissons les difficultés rencontrées",
        "nous sommes sensibles aux inquiétudes exprimées",
        "nous prenons la mesure des interrogations soulevées"
      ],
      apologies: [
        "manifestons notre proximité aux victimes et les encourageons à aller de l'avant par le pardon",
        "témoignons notre compassion aux personnes troublées et les invitons à tourner la page dans la réconciliation",
        "exprimons notre soutien aux âmes ébranlées et les accompagnons pour avancer par la miséricorde",
        "montrons notre solidarité aux personnes affectées et les encourageons à passer à autre chose dans le pardon",
        "manifestons notre compréhension aux victimes et les soutenons pour aller de l'avant par la réconciliation",
        "témoignons notre bienveillance aux personnes touchées et les invitons à tourner la page dans la miséricorde",
        "exprimons notre empathie aux victimes et les encourageons à regarder vers l'avenir par le pardon",
        "montrons notre attention aux personnes éprouvées et les accompagnons pour avancer dans la réconciliation",
        "manifestons notre fraternité aux victimes et les invitons à aller de l'avant par la miséricorde",
        "témoignons notre sollicitude aux âmes blessées et les encourageons à tourner la page dans le pardon",
        "exprimons notre proximité aux personnes affectées et les soutenons pour passer à autre chose par la réconciliation",
        "montrons notre compassion aux victimes et les accompagnons vers l'avenir dans la miséricorde"
      ],
      misericorde: [
        "Rappelons que la miséricorde divine s'étend à tous, et doit guider notre discernement",
        "Le pardon évangélique concerne chaque membre de notre communauté, y compris les accusés",
        "La miséricorde du Christ embrasse tous les enfants de Dieu sans exception",
        "La compassion divine rayonne sur chacun. La présomption d'innocence demeure fondamentale",
        "Le pardon du Seigneur s'offre à tous, même aux plus fautifs d'entre nous",
        "Méditons sur la miséricorde infinie qui unit tous nos frères, victimes et coupables présumés, dans la charité"
      ],
      actions: [
        "Nous agissons fermement en mettant en place un processus d'évaluation de nos pratiques",
        "Nous passons à l'action en renforçant nos dispositifs d'accompagnement spirituel",
        "Nous nous mobilisons résolument pour développer une démarche de discernement communautaire",
        "Nous prenons des mesures concrètes en instaurant des mécanismes de dialogue renforcés",
        "Nous nous engageons activement à consolider nos structures de formation pastorale",
        "Nous mettons tout en œuvre pour approfondir notre réflexion dans un esprit de synodalité"
      ],
      tourmentes: [
        "Dans la tourmente",
        "Au cœur de la tempête",
        "En ces temps d'épreuve",
        "Malgré les turbulences",
        "Dans cette période difficile",
        "Au sein de ces bouleversements",
        "Face à l'adversité",
        "Dans ces moments troublés",
        "Malgré les difficultés",
        "En dépit des épreuves",
        "Dans ce contexte délicat",
        "Au milieu des défis"
      ],
      goodFruits: [
        "il convient de ne pas occulter les fruits de grâce de nos paroisses",
        "nous devons garder à l'esprit les témoignages de foi de notre diocèse",
        "il serait injuste d'ignorer les actions caritatives de nos communautés",
        "nous ne saurions oublier les vocations qui confirment l'Esprit Saint",
        "rappelons-nous les signes d'espérance de notre Église",
        "gardons présents les élans missionnaires qui nous dynamisent",
        "il importe de souligner les merveilles qui s'accomplissent dans nos paroisses",
        "nous devons reconnaître les conversions authentiques de notre diocèse",
        "il serait dommage d'omettre les œuvres caritatives de nos fidèles",
        "nous ne pouvons ignorer les grâces qui abondent dans nos communautés",
        "rappelons les initiatives généreuses qui fleurissent dans notre Église",
        "gardons en mémoire les projets porteurs d'espérance qui nous animent"
      ],
      originDeflection: [
        "sans nous leurrer sur l'origine de ces perturbations",
        "en gardant à l'esprit les sources de ces troubles",
        "sans perdre de vue les ferments de division",
        "sans ignorer les véritables causes de ces difficultés",
        "en identifiant clairement les racines de ces tensions",
        "sans oublier les influences qui alimentent ces polémiques"
      ],
      scapegoats: [
        "certains médias en quête de sensationnalisme",
        "des mouvements traditionalistes fermés au souffle de l'Esprit",
        "des lobbies progressistes déconnectés de la Tradition",
        "des réseaux occultes hostiles à l'Évangile",
        "des groupuscules anticléricaux",
        "des influences séculières cherchant à saper notre rayonnement",
        "des organes de presse avides de polémiques",
        "des courants intégristes figés dans leurs certitudes",
        "des factions modernistes étrangères à l'Église",
        "des cercles opposés à la mission évangélisatrice",
        "des militants nourris de préjugés anti-religieux",
        "des forces s'acharnant à ternir notre image"
      ],
      spiritualEndings: [
        "afin d'ouvrir des fenêtres d'espérance sur l'éternité",
        "pour que jaillissent des sources de grâce dans nos cœurs",
        "en vue de faire germer la paix évangélique dans nos âmes",
        "dans l'espoir de voir fleurir la miséricorde divine",
        "pour que résonne la mélodie céleste dans nos prières",
        "afin que s'épanouisse la lumière du Christ",
        "pour que s'ouvrent les chemins de la réconciliation",
        "afin que rayonnent les fruits de l'Esprit Saint",
        "en vue de cultiver les vertus théologales dans nos communautés",
        "dans l'attente de voir grandir la communion fraternelle",
        "pour que s'accomplisse la volonté divine dans nos vies",
        "afin que se manifestent les signes du Royaume"
      ],
      closings: [
        "Concentrons-nous sur ce qui est beau et évangélique",
        "Tournons nos regards vers l'espérance chrétienne plutôt que vers les polémiques",
        "Privilégions nos liturgies aux controverses médiatiques",
        "Préférons l'écoute fraternelle aux clameurs stériles",
        "Choisissons le dialogue plutôt que les divisions",
        "Focalisons-nous sur notre mission d'évangélisation",
        "Orientons nos cœurs vers la beauté de la foi",
        "Dirigeons notre attention vers les merveilles de la Création plutôt que vers les divisions",
        "Favorisons la prière contemplative aux débats stériles",
        "Préférons la méditation spirituelle aux polémiques destructrices",
        "Choisissons la charité chrétienne plutôt que les affrontements",
        "Concentrons-nous sur l'essentiel de notre vocation pastorale"
      ]
    };

    const bishopNames = [
      "Mgr Claude-Henri de Miséricorde",
      "Mgr Adalbert de Contournement", 
      "Mgr Séraphin du Détournement",
      "Mgr Boniface de l'Esquive",
      "Mgr Théophile de la Langue-de-Bois",
      "Mgr Ambroise du Flou-Artistique",
      "Mgr Pacôme de l'Évitement",
      "Mgr Chrysostome de la Diversion",
      "Mgr Bénédict de l'Évasion",
      "Mgr Anselme du Détournement-d'Attention"
    ];

    const translations = {
      "nous reconnaissons que des dysfonctionnements ont pu survenir": "on s'est fait choper",
      "nous prenons acte des questionnements de notre communauté": "les gens râlent",
      "nous entendons les inquiétudes de nos paroissiens": "ça gueule dans les paroisses",
      "manifestons notre proximité aux victimes": "on fait semblant de compatir",
      "la miséricorde divine s'étend à tous": "on protège nos copains",
      "nous agissons fermement": "on ne fait rien de concret",
      "il convient de ne pas occulter les fruits de grâce": "regardez ailleurs",
      "sans nous leurrer sur l'origine de ces perturbations": "c'est la faute des autres"
    };

    function getRandomItem(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function calculateBullshitLevel(communique) {
      const bullshitWords = ['néanmoins', 'toutefois', 'cependant', 'miséricorde', 'synodalité', 'discernement', 'bienveillant', 'accompagnement', 'spirituel', 'évangélique'];
      let score = 0;
      bullshitWords.forEach(word => {
        const regex = new RegExp(word, 'gi');
        const matches = communique.match(regex);
        if (matches) score += matches.length;
      });
      return Math.min(Math.max(Math.ceil(score / 2), 1), 10);
    }

    function showBullshitMeter(level) {
      const meter = document.getElementById('bullshitMeter');
      const stars = document.getElementById('bullshitStars');
      stars.innerHTML = '★'.repeat(level) + '☆'.repeat(10-level);
      meter.classList.remove('hidden');
    }

    function showProgressBar() {
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      
      progressBar.classList.remove('hidden');
      
      const steps = [
        { width: 20, text: "Recherche d'excuses..." },
        { width: 40, text: "Identification des boucs émissaires..." },
        { width: 60, text: "Application de la miséricorde sélective..." },
        { width: 80, text: "Détournement d'attention en cours..." },
        { width: 100, text: "Langue de bois optimisée !" }
      ];
      
      let currentStep = 0;
      const interval = setInterval(() => {
        if (currentStep < steps.length) {
          progressFill.style.width = steps[currentStep].width + '%';
          progressText.textContent = steps[currentStep].text;
          currentStep++;
        } else {
          clearInterval(interval);
          setTimeout(() => {
            progressBar.classList.add('hidden');
          }, 1000);
        }
      }, 400);
    }

    function generateCommunique() {
      showProgressBar();
      
      setTimeout(() => {
        const incident = getRandomItem(wordLists.incidents);
        const acknowledgment = getRandomItem(wordLists.acknowledgments);
        const apology = getRandomItem(wordLists.apologies);
        const misericorde = getRandomItem(wordLists.misericorde);
        const action = getRandomItem(wordLists.actions);
        const tourmente = getRandomItem(wordLists.tourmentes);
        const goodFruit = getRandomItem(wordLists.goodFruits);
        const originDeflection = getRandomItem(wordLists.originDeflection);
        const scapegoat = getRandomItem(wordLists.scapegoats);
        const spiritualEnding = getRandomItem(wordLists.spiritualEndings);
        const closing = getRandomItem(wordLists.closings);
        const bishop = getRandomItem(bishopNames);

        const communique = `${incident}, ${acknowledgment}. En ces temps troublés, ${apology}. ${misericorde}.

${action} ${spiritualEnding}.

${tourmente}, ${goodFruit}. Il importe également, ${originDeflection}, de ne pas céder aux manœuvres de ${scapegoat}.

${closing}.`;
        
        const bullshitLevel = calculateBullshitLevel(communique);
        
        document.getElementById('result').innerHTML = `
          <div class="text-left">
            <p class="text-base font-medium text-gray-800 leading-relaxed mb-6 whitespace-pre-line">${communique}</p>
            <div class="text-right text-sm text-gray-600 italic mt-4">
              <p>+ ${bishop}</p>
              <p>Évêque de Saint-Barbant</p>
            </div>
          </div>
        `;
        
        showBullshitMeter(bullshitLevel);
        document.getElementById('translateBtn').classList.remove('hidden');
      }, 2000);
    }

    document.getElementById('generateBtn').addEventListener('click', generateCommunique);

    document.getElementById('translateBtn').addEventListener('click', function() {
      const resultDiv = document.getElementById('result');
      let content = resultDiv.innerHTML;
      
      Object.keys(translations).forEach(key => {
        const regex = new RegExp(key, 'gi');
        content = content.replace(regex, `<span class="bg-red-200 text-red-800 px-1 rounded">${translations[key]}</span>`);
      });
      
      resultDiv.innerHTML = content;
    });

    document.getElementById('resetBtn').addEventListener('click', function() {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        select.selectedIndex = 0;
      });
      document.getElementById('result').innerHTML = `<p class="text-gray-500 text-center italic">Cliquez sur "Générer un nouveau" pour créer un communiqué de miséricorde</p>`;
      document.getElementById('bullshitMeter').classList.add('hidden');
      document.getElementById('translateBtn').classList.add('hidden');
    });

    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
      select.addEventListener('change', function() {
        updateManualCommunique();
      });
    });

    function updateManualCommunique() {
      const selectedValues = {};
      selects.forEach(select => {
        if (select.value) {
          selectedValues[select.id] = select.value;
        }
      });

      if (Object.keys(selectedValues).length > 0) {
        let communique = "";
        
        // Premier paragraphe : incident + acknowledgment + apology + misericorde
        if (selectedValues.incidents) communique += selectedValues.incidents;
        if (selectedValues.acknowledgments) communique += `, ${selectedValues.acknowledgments}.`;
        if (selectedValues.apologies) communique += ` En ces temps troublés, ${selectedValues.apologies}.`;
        if (selectedValues.misericorde) communique += ` ${selectedValues.misericorde}.`;

        // Deuxième paragraphe : actions
        if (selectedValues.actions) {
          communique += `\n\n${selectedValues.actions}`;
          if (selectedValues.spiritualEndings) communique += ` ${selectedValues.spiritualEndings}.`;
        }

        // Troisième paragraphe : goodFruits + originDeflection + scapegoats
        if (selectedValues.goodFruits) communique += `\n\nDans la tourmente, ${selectedValues.goodFruits}.`;
        if (selectedValues.originDeflection || selectedValues.scapegoats) {
          communique += " Il importe également, ";
          if (selectedValues.originDeflection) communique += selectedValues.originDeflection + ", ";
          if (selectedValues.scapegoats) communique += `de ne pas céder aux manœuvres de ${selectedValues.scapegoats}.`;
        }

        // Quatrième paragraphe : closing
        if (selectedValues.closings) communique += `\n\n${selectedValues.closings}.`;

        if (communique.trim()) {
          const bishop = getRandomItem(bishopNames);
          const bullshitLevel = calculateBullshitLevel(communique);
          
          document.getElementById('result').innerHTML = `
            <div class="text-left">
              <p class="text-base font-medium text-gray-800 leading-relaxed mb-6 whitespace-pre-line">${communique}</p>
              <div class="text-right text-sm text-gray-600 italic mt-4">
                <p>+ ${bishop}</p>
                <p>Évêque de Saint-Barbant</p>
              </div>
            </div>
          `;
          
          showBullshitMeter(bullshitLevel);
          document.getElementById('translateBtn').classList.remove('hidden');
        }
      }
    }
  </script>
</Layout>
